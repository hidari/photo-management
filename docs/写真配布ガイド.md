# 写真配布ガイド

## 概要

撮影した写真をGoogle Driveにアップロードするコマンドと、モデルに配布するためのコマンドで構成されています。

## アップロード

### コマンド

```bash
# フォルダ共有（対話形式）
deno task upload

# フォルダ共有方式（一括）
deno task upload --all

# zip配布方式
deno task upload --all --as-archive
```

### 配布方式の比較

| 項目       | フォルダ共有    | zip配布                |
|----------|-----------|----------------------|
| コマンド     | `--all`   | `--all --as-archive` |
| 形式       | フォルダ単位で共有 | zipアーカイブ             |
| ダウンロード時間 | 短い（選択可能）  | 長い（全体DL必須）           |
| 推奨用途     | 通常配布      | 大量写真の一括配布            |

### 実行内容

`deno task upload --all` を実行すると、以下が自動で行われます：

1. Google Driveへのアップロード
   - 各モデルのフォルダまたはzipファイルをアップロード
   - アップロード先: `Photo Distribution/[イベント名]/[モデル毎のフォルダ]`
   - 共有リンクを自動生成

2. 配布メッセージの生成
   - モデル別の配布用メッセージを自動生成
   - ダウンロードリンクを含む

3. SNSの設定がX（Twitter）の場合はDMインテントURLの生成
   - ワンクリックでDM画面を開けるURL
   - メッセージがプリセット済み

4. distribution.config.tomlの自動更新
   - ダウンロードURLを保存
   - 配布メッセージを保存

## 配布実行

### コマンド

```bash
deno task ship
```

### 実行内容

対話的にモデルを選択すると、以下が自動で行われます：

1. アップロード済みモデルの一覧表示
   - アップロード済みで未配布のモデルのみ表示
   - 配布済みのモデルは表示されない

2. モデルの選択

3. ブラウザでDM画面を開く
   - 選択したモデルのDM画面が自動で開く
   - メッセージが自動入力済み
   - 送信ボタンを押すだけ

4. 配布済みフラグの更新
   - `distribution.config.toml` に配布済みフラグを更新
   - 次回実行時には表示されない

## ワークフロー例

### 基本的な配布フロー

1. 写真をアップロード
   ```bash
   deno task upload --all
   ```

2. モデルに配布
   ```bash
   deno task ship
   ```
   - ブラウザが開いたらメッセージを確認して送信

3. 完了

### zip配布の場合

大量の写真を配布する場合や、ダウンロードを簡単にしたい場合：

```bash
deno task upload --all --as-archive
deno task ship
```

zip形式でアップロードされるため、モデルは1つのファイルをダウンロードするだけで全写真を取得できます。

## トラブルシューティング

### アップロードが失敗する

1. Google Drive認証の確認
   - `~/.config/photo-management/google-drive-token.json` を削除して再認証を試みる

2. ファイル名の確認
   - 特殊文字やスペースが含まれていないか確認
   - 日本語ファイル名は問題なし

3. 容量の確認
   - Google Driveの容量が十分か確認

### shipコマンドでブラウザが開かない

1. デフォルトブラウザの確認
   - システムのデフォルトブラウザが設定されているか確認

2. 手動でURLを開く
   - `distribution.config.toml` からURLをコピーして手動で開く

### 配布済みフラグが更新されない

1. distribution.config.tomlの確認
   - ファイルが正しく存在するか確認
   - 書き込み権限があるか確認

2. 再実行
   ```bash
   deno task ship
   ```

## 次のステップ

配布が完了したら、必要に応じて[メンテナンスガイド](./メンテナンスガイド.md)を参照して古いフォルダを削除してください。
