# メンテナンスガイド

## 概要

写真配布後のメンテナンス作業を行うためのコマンドの説明です。

## 古いフォルダ削除

### コマンド

```bash
deno task cleanup            # 削除対象を表示
deno task cleanup --execute  # 削除実行
```

### 実行内容

Google Drive上の古い写真配布フォルダを削除します。

- 対象: `PhotoDistribution/` 配下のフォルダ
- 削除基準: 指定した日数より古いフォルダ
- 安全性: 対話的に確認してから削除

### いつ実行すべきか

以下のタイミングで実行することを推奨します：

1. 定期的なメンテナンス
   - 月に1回程度
   - Google Driveの容量を確保するため

2. 配布完了後
   - モデルがダウンロード完了したことを確認してから
   - 通常は配布後1〜2週間程度

3. 容量不足時
   - Google Driveの容量が不足してきた場合

### 削除基準のカスタマイズ

デフォルトでは90日以上前のフォルダが対象ですが、実行時にオプションで変更できます：

```bash
# 60日以上前のフォルダを削除
deno task cleanup --days 60

# 14日以上前のフォルダを削除
deno task cleanup --days 14
```

### 注意事項

#### 削除前の確認事項

1. モデルのダウンロード完了を確認
   - モデルが写真をダウンロード済みか確認
   - 必要に応じてモデルに事前連絡

2. ローカルのバックアップ確認
   - 元の写真がローカルに保存されているか確認
   - 削除後は復元できません

3. 配布状況の確認
   - `distribution.config.toml` で配布状況を確認
   - 配布済み（`distributed = true`）であることを確認

#### 削除対象外のフォルダ

以下のフォルダは削除されません：

- 指定日数以内に作成されたフォルダ
- `PhotoDistribution/` 配下以外のフォルダ
- 共有設定がされていないフォルダ（誤削除防止）

#### 削除の取り消し

Google Driveのゴミ箱から30日以内であれば復元可能です：

1. [Google Drive](https://drive.google.com/) を開く
2. 左メニューの「ゴミ箱」をクリック
3. 復元したいフォルダを右クリック
4. 「復元」を選択

## ワークフロー例

### 月次メンテナンス

```bash
# 1. 配布状況を確認
cat */distribution.config.toml | grep "distributed"

# 2. モデルにダウンロード完了を確認（任意）

# 3. 古いフォルダを削除
deno task cleanup -execute
```

### 個別イベントのクリーンアップ

特定のイベントだけを削除したい場合は、Google Driveから直接削除することもできます：

1. [Google Drive](https://drive.google.com/) を開く
2. `Photo Distribution/` フォルダに移動
3. 削除したいイベントフォルダを選択
4. ゴミ箱に移動

## トラブルシューティング

### フォルダが削除されない

1. 権限の確認
   - Google Driveにログインしているアカウントが正しいか確認
   - フォルダの所有者であるか確認

2. 共有設定の確認
   - フォルダが他のユーザーと共有されている場合、削除できない場合があります

### 誤って削除してしまった

Google Driveのゴミ箱から復元してください（30日以内）：

1. [Google Drive](https://drive.google.com/) を開く
2. 左メニューの「ゴミ箱」
3. 該当フォルダを右クリック → 「復元」

## 関連コマンド

- [初期設定ガイド](./初期設定ガイド.md) - 初回セットアップ
- [イベント作成ガイド](./イベント作成ガイド.md) - イベント作成とモデル追加
- [写真配布ガイド](./写真配布ガイド.md) - アップロードと配布
